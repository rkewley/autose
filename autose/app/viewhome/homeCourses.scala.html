@(vCourses: MdlCourses)(implicit user: MdlUser)

@import persistence._
@import utilities.FileGroup
@import play.api.mvc._

@coursePage(vCourses) {
   <div>
	<div class="column span-14 colborder">
		<h3>@vCourses.vCourseName</h3>
        
		<div>@Html(vCourses.vCourseDescriptionWebsite)</div>
		<hr>
		
		 <h4>@vCourses.vCourseIDNumber References</h4>
		 <ul>
		 @defining(SqlCourseReferences.selectWhere("Course = " + vCourses.vidCourse.get)) { listCourseReferences =>
		     @defining(listCourseReferences.map(r=>"idReference = " + r.vReference).mkString(" OR ")) { whereClause =>
		       @if(whereClause.length > 0) {
		         @defining(SqlReference.selectWhere(whereClause).sortWith(MdlReference.compare)) { listReferences =>
		           @listReferences.map { vReference =>
		                @defining(Globals.stripLink(vReference.vLink)) { newLink =>
							@if(newLink.startsWith("http")) {
								<li><a href="@vReference.vLink">@vReference.vTitle.</a>  @vReference.vText</li>
							} else {

								<li><a href="@routes.AmazonS3Controller.sendS3File(newLink)">@vReference.vTitle.</a>  @vReference.vText</li>
         			    }
				   }
			         
			       }
			     }
			   }
			 }
		 }
		 </ul>
	</div>
	
	<div class="column span-4 last">
	  	@if(user.hasEditPermission){<form method="GET" action="@routes.CourseLinksController.uploadCourseFile(vCourses.vidCourse.get)">
			<input type="submit" value="Upload Course File">
		</form>}

	  <ul id="menu">
		@defining(FileGroup.getFileGroupsCourseLinks(SqlCourseLinks.selectWhere("Course = " + vCourses.vidCourse.get + " AND IsFileLink = 1"))) { listCourseLinks =>
       		@listCourseLinks.map { fileGroup =>
         		@if(fileGroup.owner == "Course level file") {
         			  <li id="label">Course level files</li>
         			  @fileGroup.links.map { fgLink =>
         			 	@defining(Globals.stripLink(fgLink.href)) { newLink =>
         			    	<li><a href="@routes.AmazonS3Controller.sendS3File(newLink)">@fgLink.description</a></li>
         			    }
         			  } 
         		} else {
         			  <li>"< "@fileGroup.owner
         			    <ul>
         			      @fileGroup.links.map { fgLink =>
         			 		@defining(Globals.stripLink(fgLink.href)) { newLink =>
         			    		<li><a href="@routes.AmazonS3Controller.sendS3File(newLink)">@fgLink.description</a></li>
         			    	}
         			      }
         			    </ul>
         			  </li>    
         		}
		 	}
	   	}
	  </ul>

	  	@if(user.hasEditPermission){<form method="GET" action="@routes.CourseLinksController.createCourseLinks(vCourses.vidCourse.get)">
			<input type="submit" value="Create Course Link">
		</form>}
		
	  <ul id="menu">
		@defining(FileGroup.getFileGroupsCourseLinks(SqlCourseLinks.selectWhere("Course = " + vCourses.vidCourse.get + " AND IsFileLink = 0"))) { listCourseLinks =>
       		@listCourseLinks.map { fileGroup =>
         		@if(fileGroup.owner == "Course level file") {
         			  <li id="label">Course level links</li>
         			  @fileGroup.links.map { fgLink =>
         			    <li><a href="@fgLink.href">@fgLink.description</a></li>
         			  } 
         		} else {
         			  <li>@fileGroup.owner
         			    <ul>
         			      @fileGroup.links.map { fgLink =>
         			        <li><a href="@fgLink.href">@fgLink.description</a></li>
         			      }
         			    </ul>
         			  </li>    
         		}
		 	}
	   	}
	  </ul>
	</div>
  </div>
}
	
