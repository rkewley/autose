
@(vLessons: MdlLessons)

@import persistence._
		    
@lessonPage(vLessons.vLessonIndex) {

    
     <div class="column span-14">
		  <h2>Lesson @vLessons.vLessonNumber: @vLessons.vLessonName</h2>
		  <p>Location: @vLessons.vLocation, Duration: @vLessons.vDuration, 
		    Lab: @{vLessons.vLab match {case true => "Yes" case false => "No"}}</p> 
		  
		  <h4>Assignment</h4>
		  <p>@Html(vLessons.vAssignment.toString)</p>

		  <h4>Lesson Summary</h4>
		  <p>@Html(vLessons.vLessonSummary.toString)</p>
		  
		  <h4>Knowledge and Skills Covered During the Lesson</h4>
		  @defining({ 
		  	(SqlLessonTopicObjectives.selectWhere("Lesson = " + vLessons.vLessonIndex)).map(lto =>
		  	  
		  	    (SqlTopicObjectives.select(lto.vTopicObjective), SqlTopics.select((SqlTopicObjectives.select(lto.vTopicObjective)).vTopic))
		  	  
		  	)})  { toData =>
  		@defining(SqlLessonLinks.selectWhere("Lesson = " + vLessons.vLessonIndex)) { lessonLinks =>
  		@defining(SqlLessonLinkTopicObjectives.all) { lltos =>
		  	<table>
		  	  <tr>
		  	    <th>Topic</th> 
		  	    <th>Objective</th>
		  	    <th>Type</th>
		  	    <th>Files</th>
		  	  </tr>
		  	  @toData.map { dataRow =>
		  	    <tr>
		  	      @*<td>@dataRow._2.vTopic</td>*@
		  	      <td><a href="@routes.TopicsController.homeTopics(dataRow._2.vTopicsIndex)">@dataRow._2.vTopic</a></td>
		  	      <td>@dataRow._1.vObjective</td>
		  	      <td>@dataRow._1.vKSAB</td>
		  	      <td>
		  	      @defining(lltos.filter(llto => llto.vTopicObjective == dataRow._1.vTopicObjectiveNumber)) { relevantlltos =>
		  	        @defining(lessonLinks.filter(ll => relevantlltos.map(_.vLessonLink).contains(ll.vLessonLinkNumber))) { links =>
					  @links.map { link =>
		  			    <p><small><a href="@link.vLink">@link.vDescription</a></small></p>
					  }
					}
				  }
		  	      @*
   		 			@{lessonLinks.filter(ll => 
   		 			  (lltos.filter(llto => 
   		 			    llto.vTopicObjective == dataRow._1.vTopicObjectiveNumber
   		 			  ).map(_.vLessonLink).contains(ll.vLessonLinkNumber))
   		 			)}.map { link =>
		  			  <p><small><a href="@link.vLink">@link.vDescription</a></small></p>
		 			} 
				  *@
				  
		  	      </td>
		  	    </tr>
		  	  }
		  	
		  	</table>
		  	}
		}
		}
		
	       
     <div>
       <a href="@routes.LessonsController.listLessons(vLessons.vidCourse)">Return to listing</a>
     </div>
	</div>
  @defining(SqlLessonLinks.selectWhere("Lesson = " + vLessons.vLessonIndex)) { lessonLinks =>
    @println("Number of lesson links is " + lessonLinks.size)
    <div class="column span-4 last">
   		 <h4>Lesson Links and Files</h4>
   		 @lessonLinks.map { link =>
		  	<p><a href="@link.vLink">@link.vDescription</a></p>
		 } 
     </div>
   }
  </div>
  
}