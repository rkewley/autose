
@(vLessons: MdlLessons)(implicit user: MdlUser)

@import persistence._
@import slick.AppDB
@import utilities.FileGroup
@import models._
		    
@lessonPage(vLessons.vLessonIndex) {

    
     <div class="column span-14">
		  <h2>Lesson @vLessons.vLessonNumber: @vLessons.vLessonName</h2>
		  <p>Location: @vLessons.vLocation, Duration: @vLessons.vDuration, 
		    Lab: @{vLessons.vLab match {case true => "Yes" case false => "No"}}</p> 
		  
		  <h4>Assignment</h4>
		  <p>@Html(vLessons.vAssignment.toString)</p>

		 @if(user.hasEditPermission){<form method="GET" action="@routes.LessonObjectiveController.list(vLessons.vLessonIndex)">
			 <input type="submit" value="Edit Lesson Objectives">
		 </form>}
		  <h4>Lesson Objectives</h4>
		  <ul>
		  @for(lo <- AppDB.dal.LessonObjective.selectForLesson(vLessons.vLessonIndex)) {
			  <li>@lo.vLessonObjective</li>
		  }
		  </ul>

		  <h4>Lesson Summary</h4>
		  <p>@Html(vLessons.vLessonSummary.toString)</p>


		
		
		
	       
     <div>
       <a href="@routes.LessonsController.listLessons(vLessons.vidCourse)">Return to listing</a>
     </div>
	</div>
	
	
	<div class="column span-4 last">
	  Files
	  	@if(user.hasEditPermission){<form method="GET" action="@routes.LessonLinksController.uploadLessonFile(vLessons.vLessonIndex)">
			<input type="submit" value="Upload Lesson File">
		</form>}
	  
	  <ul id="menu">
	  @defining(AppDB.dal.LessonLinks.all.filter(lsnLink => lsnLink.vLesson == vLessons.vLessonIndex)) { lessonLinks =>
		@defining(FileGroup.getFileGroupsLessonLinks(lessonLinks.filter(lessonLink => lessonLink.vIsFileLiink == true))) { listLessonLinks =>
       		@listLessonLinks.map { fileGroup =>

         		@if(fileGroup.owner == "Course level file") {
         			  <li id="label">Course level files</li>
         			  @fileGroup.links.map { fgLink =>
         			 	@defining(Globals.stripLink(fgLink.href)) { newLink =>
         			    	<li><a href="@routes.AmazonS3Controller.sendS3File(newLink)">@fgLink.description</a></li>
         			    }
         			  } 
         		} else {
         			  <li>< @fileGroup.owner
         			    <ul>
         			      @fileGroup.links.map { fgLink =>
         			      	@defining(Globals.stripLink(fgLink.href)) { newLink =>
         			    		<li><a href="@routes.AmazonS3Controller.sendS3File(newLink)">@fgLink.description</a></li>
         			    	}
         			      }
         			    </ul>
         			  </li>    
         		}
		 	}
	   	}
	  </ul>

	  Links
	  	@if(user.hasEditPermission){<form method="GET" action="@routes.LessonLinksController.create(vLessons.vLessonIndex)">
			<input type="submit" value="Create Lesson Link">
		</form>}
	  <ul id="menu">
		@defining(FileGroup.getFileGroupsLessonLinks(lessonLinks.filter(lessonLink => lessonLink.vIsFileLiink == false))) { listLessonLinks =>
       		@listLessonLinks.map { fileGroup =>

         		@if(fileGroup.owner == "Course level file") {
         			  <li id="label">Course level links</li>
         			  @fileGroup.links.map { fgLink =>
         			    <li><a href=@fgLink.href>@fgLink.description</a></li>
         			  } 
         		} else {
         			  <li>< @fileGroup.owner
         			    <ul>
         			      @fileGroup.links.map { fgLink =>
         			    	<li><a href=@fgLink.href>@fgLink.description</a></li>
         			      }
         			    </ul>
         			  </li>    
         		}
		 	}
	   	}
	  </ul>
	</div>


  }
  </div>
}
